name: M2UFileCopy

on:
  workflow_dispatch:

jobs:
  Cleanup-Workspce:
    runs-on: ubuntu2
    steps:
    - name: Cleanup work space directory
      run: |
       echo "Branch: $GITHUB_REF_NAME"
       rm -rf $GITHUB_WORKSPACE
       mkdir -p $GITHUB_WORKSPACE
       ls -ld $GITHUB_WORKSPACE

  Cleanup-MigrationDir:
    needs: Cleanup-Workspce
    runs-on: ubuntu2
    steps:
    - name: Cleanup work space directory
      run: |
       echo "Branch: $GITHUB_REF_NAME"
       rm -rf /root/bv_data /root/checksum1


  Download-Repo:
    needs: Cleanup-MigrationDir
    runs-on: ubuntu2
    steps:
    - name: Checkout destination repository
      uses: actions/checkout@v3

    - name: Check downloaded repo.
      run: |
       echo "Branch: $GITHUB_REF_NAME"
       echo " WORKSPACE = $GITHUB_WORKSPACE"
       ls -lrtR $GITHUB_WORKSPACE

  Copy-Repo:
    needs: Download-Repo
    runs-on: ubuntu2


    steps:
    - name: Copy files to remote server
      run: |
        ssh mohan@10.1.1.3 "sudo /home/mohan/script1"
        scp -rp $GITHUB_WORKSPACE/bv_data mohan@10.1.1.3
        scp -p $GITHUB_WORKSPACE/checksum1 mohan@10.1.1.3
        ssh mohan@10.1.1.3 "sudo /home/mohan/script1"
